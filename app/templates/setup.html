<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roue CSI - Premiere installation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<div class="accueil-container">
    <h1 class="accueil-title">Premiere installation</h1>
    <p class="accueil-subtitle">Creez le compte administrateur</p>

    {% if error %}
    <p style="color:#dc2626;font-size:13px;margin-bottom:12px">{{ error }}</p>
    {% endif %}

    <form method="POST" class="login-form">
        <div class="login-field">
            <label for="email">Email</label>
            <input type="email" id="email" name="email"
                   value="{{ prefill.email or '' }}"
                   placeholder="prenom.nom@entreprise.com" required autofocus>
        </div>
        <div class="login-field">
            <label for="nom">Nom</label>
            <input type="text" id="nom" name="nom"
                   value="{{ prefill.nom or '' }}"
                   placeholder="NOM, Prenom" required>
        </div>
        <div class="login-field">
            <label for="trigramme">Trigramme</label>
            <input type="text" id="trigramme" name="trigramme"
                   value="{{ prefill.trigramme or '' }}"
                   placeholder="ABC" maxlength="4"
                   style="text-transform:uppercase;width:80px;letter-spacing:2px;font-weight:700;text-align:center">
            <span style="font-size:10px;color:#555;margin-left:6px">Auto-suggere depuis le nom</span>
        </div>
        <div class="login-field">
            <label for="password">Mot de passe</label>
            <input type="password" id="password" name="password"
                   placeholder="6 caracteres minimum" required>
        </div>
        <div class="login-field">
            <label for="password2">Confirmer le mot de passe</label>
            <input type="password" id="password2" name="password2"
                   placeholder="Repetez le mot de passe" required>
        </div>
        <button type="submit" class="project-card-btn" style="margin-top:12px;padding:10px 32px;font-size:14px;border:none;border-radius:8px;cursor:pointer">
            Creer le compte
        </button>
    </form>
</div>

<script>
(function() {
    var nomInput = document.getElementById('nom');
    var triInput = document.getElementById('trigramme');
    if (!nomInput || !triInput) return;
    var userEdited = false;
    triInput.addEventListener('input', function() { userEdited = true; });

    nomInput.addEventListener('input', function() {
        if (userEdited) return;
        var nom = nomInput.value.trim();
        if (!nom) { triInput.value = ''; return; }
        fetch('/api/trigramme/suggest?nom=' + encodeURIComponent(nom))
            .then(function(r) { return r.json(); })
            .then(function(d) { if (!userEdited) triInput.value = d.trigramme; });
    });

    if (nomInput.value.trim() && !triInput.value) {
        nomInput.dispatchEvent(new Event('input'));
    }
})();
</script>

</body>
</html>
