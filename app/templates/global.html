{% extends "base.html" %}

{% block title %}Roue CSI - Vue Globale{% endblock %}

{% block breadcrumb %}
<span class="current">Vue Globale</span>
{% endblock %}

{% block sidebar %}
<div class="sidebar-section">
    <h4>Categories</h4>
    {% for cat in data.categories %}
    <a class="sidebar-item" href="{{ url_for('main.vue_categorie', id=cat.id) }}"
       title="{{ cat.nom }} - {{ cat.count }} indicateurs">
        <span class="sidebar-dot" style="background:{{ COL[cat.worst] }}"></span>
        <span>{{ cat.nom }}</span>
        <span class="sidebar-count">{{ cat.count }}</span>
    </a>
    {% endfor %}
</div>
{% endblock %}

{% block content %}
<div class="view-header">
    <div>
        <h2>Vue Globale</h2>
        <div class="subtitle">{{ data.total }} indicateurs</div>
    </div>
    <a class="kanban-new-btn" href="{{ url_for('main.vue_kanban_global') }}" style="text-decoration:none">Actions (Kanban)</a>
</div>
<div class="wheel-area">
    <svg id="wh-global" width="440" height="440" viewBox="0 0 440 440"></svg>
    <div class="right-panels">
        <div id="sp-global"></div>
    </div>
</div>
<div class="hint">Cliquez sur une etape de la roue pour voir le detail</div>
<div class="drill-edit" id="drill-area"></div>
{% endblock %}

{% block scripts %}
<script>
(function() {
    var wheelColors = {{ data.wheel_colors|tojson }};
    var statusCounts = {{ data.status_counts|tojson }};
    var drillData = {{ drill_data|tojson }};
    var globalLayerValues = {{ global_layer_values|tojson }};

    drawSimpleWheel('wh-global', wheelColors, {
        c1: 'VUE GLOBALE',
        c2: '{{ data.total }} indicateurs',
        onClick: function(idx) {
            showGlobalDrill(idx, drillData, globalLayerValues);
        }
    });

    buildStatusPanel('sp-global', statusCounts);
})();
</script>
{% endblock %}
